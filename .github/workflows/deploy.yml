name: Deploy to FPGA via Raspberry Pi

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'piApp/encrypted.txt'
      - 'piApp/**'
      - '.github/workflows/deploy.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Verify encrypted file exists
        run: |
          if [ ! -f piApp/encrypted.txt ]; then
            echo "ERROR: encrypted.txt not found!"
            exit 1
          fi
          echo "✓ encrypted.txt found"
      
      - name: Build and send to FPGA
        run: |
          cd piApp
          g++ -o fpga_sender main.cpp
          ./fpga_sender --file encrypted.txt
      
      - name: Deployment complete
        if: github.event_name == 'push'
        run: |
          echo "✓ Encrypted data sent to FPGA via Raspberry Pi!"
